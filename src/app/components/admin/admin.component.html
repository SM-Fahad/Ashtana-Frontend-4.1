<div class="container">
<!-- admin.component.html -->
<div class="admin-dashboard container-fluid py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2 fw-bold text-dark mb-1">ASHTANA Admin</h1>
      <p class="text-muted mb-0">Real-time analytics and management</p>
    </div>
    <div class="d-flex gap-2 flex-wrap">
      <button class="btn btn-outline-primary" (click)="refreshData()">
        <i class="bi bi-arrow-clockwise me-2"></i> Refresh
      </button>
      <button class="btn btn-primary" routerLink="/category-list">
        <i class="bi bi-tags me-2"></i> Categories
      </button>
      <button class="btn btn-primary" routerLink="/sub-category-list">
        <i class="bi bi-diagram-3 me-2"></i> Sub-Categories
      </button>
      <button class="btn btn-primary" routerLink="/color-list">
        <i class="bi bi-palette me-2"></i> Colors
      </button>
      <button class="btn btn-primary" routerLink="/size-list">
        <i class="bi bi-aspect-ratio me-2"></i> Sizes
      </button>
      <button class="btn btn-primary" routerLink="/product">
        <i class="bi bi-box-seam me-2"></i> Products
      </button>
    </div>
  </div>

  <!-- Stats Overview -->
  <div class="row g-3 mb-4">
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-sm h-100 stat-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="bg-primary bg-opacity-10 rounded p-3 me-3">
              <i class="bi bi-currency-dollar text-primary fs-4"></i>
            </div>
            <div class="flex-grow-1">
              <h3 class="fw-bold text-dark mb-0">{{ totalRevenue | currency:'USD':'symbol':'1.0-0' }}</h3>
              <span class="text-muted">Total Revenue</span>
              <div class="mt-1">
                <span [class]="'badge ' + (getRevenueGrowth() >= 0 ? 'bg-success bg-opacity-10 text-success' : 'bg-danger bg-opacity-10 text-danger')">
                  <i [class]="getRevenueGrowth() >= 0 ? 'bi bi-arrow-up me-1' : 'bi bi-arrow-down me-1'"></i>
                  {{ getRevenueGrowth().toFixed(1) }}%
                </span>
                <small class="text-muted ms-1">vs last month</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-sm h-100 stat-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="bg-success bg-opacity-10 rounded p-3 me-3">
              <i class="bi bi-cart-check text-success fs-4"></i>
            </div>
            <div class="flex-grow-1">
              <h3 class="fw-bold text-dark mb-0">{{ totalOrders }}</h3>
              <span class="text-muted">Total Orders</span>
              <div class="mt-1">
                <span class="badge bg-success bg-opacity-10 text-success">
                  <i class="bi bi-arrow-up me-1"></i>{{ conversionRate.toFixed(1) }}%
                </span>
                <small class="text-muted ms-1">conversion rate</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-sm h-100 stat-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="bg-warning bg-opacity-10 rounded p-3 me-3">
              <i class="bi bi-box-seam text-warning fs-4"></i>
            </div>
            <div class="flex-grow-1">
              <h3 class="fw-bold text-dark mb-0">{{ totalProducts }}</h3>
              <span class="text-muted">Total Products</span>
              <div class="mt-1">
                <span *ngIf="lowStockProducts > 0" class="badge bg-danger bg-opacity-10 text-danger">
                  <i class="bi bi-exclamation-triangle me-1"></i>{{ lowStockProducts }} low stock
                </span>
                <span *ngIf="lowStockProducts === 0" class="badge bg-success bg-opacity-10 text-success">
                  <i class="bi bi-check me-1"></i>All stocked
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-3 col-md-6">
      <div class="card border-0 shadow-sm h-100 stat-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="bg-info bg-opacity-10 rounded p-3 me-3">
              <i class="bi bi-people text-info fs-4"></i>
            </div>
            <div class="flex-grow-1">
              <h3 class="fw-bold text-dark mb-0">{{ totalCustomers }}</h3>
              <span class="text-muted">Total Customers</span>
              <div class="mt-1">
                <span class="badge bg-info bg-opacity-10 text-info">
                  <i class="bi bi-person-plus me-1"></i>{{ pendingOrders }} active
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row -->
  <div class="row g-4 mb-4">
    <!-- Revenue Chart -->
    <div class="col-xl-8">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-transparent border-0 py-3">
          <h5 class="card-title mb-0 fw-semibold">Revenue Analytics</h5>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas #revenueChart></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Status Chart -->
    <div class="col-xl-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-transparent border-0 py-3">
          <h5 class="card-title mb-0 fw-semibold">Order Status</h5>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas #orderStatusChart></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Products & Orders Row -->
  <div class="row g-4">
    <!-- Products Section -->
    <div class="col-xl-8">
      <div>
        <app-product-list></app-product-list>
      </div>

      <!-- Recent Orders Section -->
      <div class="card border-0 shadow-sm mt-4">
        <div class="card-header bg-transparent border-0 py-3 d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0 fw-semibold">Recent Orders</h5>
          <button class="btn btn-outline-primary btn-sm" routerLink="/orders">
            <i class="bi bi-eye me-2"></i> View All Orders
          </button>
        </div>
        <div class="card-body">
          <div *ngIf="isLoadingOrders" class="text-center py-3">
            <div class="spinner-border spinner-border-sm text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-muted mt-2 mb-0">Loading orders...</p>
          </div>

          <div *ngIf="!isLoadingOrders && recentOrders.length === 0" class="text-center py-4">
            <i class="bi bi-cart-x text-muted fs-1 mb-3"></i>
            <h5 class="text-muted">No Orders Yet</h5>
            <p class="text-muted mb-0">Orders will appear here once customers start purchasing</p>
          </div>

          <div class="table-responsive" *ngIf="!isLoadingOrders && recentOrders.length > 0">
            <table class="table table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th scope="col">Order ID</th>
                  <th scope="col">Customer</th>
                  <th scope="col">Date</th>
                  <th scope="col">Amount</th>
                  <th scope="col">Status</th>
                  <th scope="col">Items</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let order of recentOrders">
                  <td>
                    <strong>{{ order.orderNumber || 'ORD-' + order.id }}</strong>
                  </td>
                  <td>{{ order.userName }}</td>
                  <td>{{ formatDate(order.orderDate) }}</td>
                  <td class="fw-semibold text-primary">{{ formatCurrency(order.totalAmount) }}</td>
                  <td>
                    <span [class]="'badge status-badge ' + getStatusBadgeClass(order.status)">
                      {{ order.status | titlecase }}
                    </span>
                  </td>
                  <td>
                    <span class="text-muted">{{ order.items?.length || 0 }} items</span>
                  </td>
                  <td>
                    <button class="btn btn-outline-primary btn-sm" (click)="viewOrderDetails(order.id)">
                      <i class="bi bi-eye"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="col-xl-4">
      <!-- Quick Stats -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-transparent border-0 py-3">
          <h5 class="card-title mb-0 fw-semibold">Quick Stats</h5>
        </div>
        <div class="card-body">
          <div class="row g-3 text-center">
            <div class="col-6">
              <div class="border rounded p-3 stat-item">
                <h4 class="fw-bold text-primary mb-1">{{ averageOrderValue | currency:'USD':'symbol':'1.0-0' }}</h4>
                <small class="text-muted">Avg Order Value</small>
              </div>
            </div>
            <div class="col-6">
              <div class="border rounded p-3 stat-item">
                <h4 class="fw-bold text-success mb-1">{{ conversionRate.toFixed(1) }}%</h4>
                <small class="text-muted">Conversion Rate</small>
              </div>
            </div>
            <div class="col-6">
              <div class="border rounded p-3 stat-item">
                <h4 class="fw-bold text-warning mb-1">{{ pendingOrders }}</h4>
                <small class="text-muted">Pending Orders</small>
              </div>
            </div>
            <div class="col-6">
              <div class="border rounded p-3 stat-item">
                <h4 class="fw-bold text-info mb-1">{{ lowStockProducts }}</h4>
                <small class="text-muted">Low Stock Items</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-transparent border-0 py-3">
          <h5 class="card-title mb-0 fw-semibold">Quick Actions</h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <button class="btn btn-outline-primary text-start action-item" routerLink="/category-list">
              <i class="bi bi-tags me-2"></i> Manage Categories
            </button>
            <button class="btn btn-outline-primary text-start action-item" routerLink="/product">
              <i class="bi bi-box-seam me-2"></i> Manage Products
            </button>
            <button class="btn btn-outline-primary text-start action-item" routerLink="/orders">
              <i class="bi bi-cart-check me-2"></i> View All Orders
            </button>
            <button class="btn btn-outline-success text-start action-item" (click)="exportReports()">
              <i class="bi bi-download me-2"></i> Export Reports
            </button>
          </div>
        </div>
      </div>

      <!-- Top Products -->
      <!-- <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-transparent border-0 py-3">
          <h5 class="card-title mb-0 fw-semibold">Top Products</h5>
        </div>
        <div class="card-body">
          <div *ngIf="isLoadingProducts" class="text-center py-2">
            <div class="spinner-border spinner-border-sm text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>

          <div *ngIf="!isLoadingProducts && products.length === 0" class="text-center py-3">
            <p class="text-muted small mb-0">No products available</p>
          </div>

          <div class="top-products-list" *ngIf="!isLoadingProducts && products.length > 0">
            <div *ngFor="let product of products.slice(0, 5)" class="top-product-item">
              <div class="d-flex align-items-center gap-2">
                <img 
                  [src]="getProductImageUrl(product)" 
                  [alt]="product.name"
                  class="rounded flex-shrink-0 top-product-image"
                  (error)="handleImageError($event)">
                <div class="flex-grow-1">
                  <h6 class="mb-0 fw-semibold text-truncate top-product-name">
                    {{ product.name }}
                  </h6>
                  <small class="text-muted">{{ product.price | currency }}</small>
                </div>
                <span class="badge bg-light text-dark border top-product-stock">
                  {{ product.stock || 0 }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div> -->

      <!-- System Status -->
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-transparent border-0 py-3">
          <h5 class="card-title mb-0 fw-semibold">System Status</h5>
        </div>
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="fw-semibold">API Connection</span>
            <span class="badge bg-success">Connected</span>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="fw-semibold">Database</span>
            <span class="badge bg-success">Online</span>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <span class="fw-semibold">Last Sync</span>
            <span class="text-muted">{{ currentTime }}</span>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="fw-semibold">Uptime</span>
            <span class="text-muted">99.9%</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>